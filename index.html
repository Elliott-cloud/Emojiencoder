<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Creative Canvas</title>
    <style>
        body {
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: #c0c0c0; /* ÁªèÂÖ∏WindowsÁÅ∞Ëâ≤ËÉåÊôØ */
            transition: background-color 0.5s;
        }
        .main-wrapper {
            min-height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 880px;
            width: 82.5vh;
            height: 82.5vh;
            margin: 0;
            padding: 22px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            background-color: #c0c0c0; /* WindowsÁÅ∞Ëâ≤ */
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* ÁªèÂÖ∏Windows 3DËæπÊ°Ü */
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            box-shadow: 1px 1px 0 #000000; /* ÁÆÄÂçïÈò¥ÂΩ± */
            position: relative;
        }
        .container::before {
            content: "üõë VIRUS!! - EmojiEncoder.exe";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #000080; /* WindowsËìù */
            color: white;
            font-weight: bold;
            padding: 2px 5px;
            box-sizing: border-box;
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            font-size: 14px;
        }
        .container::after {
            content: "";
            position: absolute;
            top: 4px;
            right: 4px;
            width: 62px;
            height: 14px;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD4AAAAOCAYAAABXuSs5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGtmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIyLTAzLTIyVDE1OjIzOjE1KzAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMi0wMy0yMlQxNToyNToxOSswMzowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMi0wMy0yMlQxNToyNToxOSswMzowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3Y2JkOTg2ZC0zZmMwLTM4NDEtOWUzNy00NDQyODZlNjJjY2MiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo2NWQ4ZDk2Ny1iYmFkLTMyNGItODQzNS05YTIyYzUxM2ZkNGUiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo5NjgwNzFmNy0wY2RkLWJlNDMtOWE4MC0wZjQyYjhiMDQxMjAiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjk2ODA3MWY3LTBjZGQtYmU0My05YTgwLTBmNDJiOGIwNDEyMCIgc3RFdnQ6d2hlbj0iMjAyMi0wMy0yMlQxNToyMzoxNSswMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo3MWUyM2E3MC0yOTNmLTc0NGQtOWYyOS1jYTU5ZGU3YzM3MDEiIHN0RXZ0OndoZW49IjIwMjItMDMtMjJUMTU6MjU6MTkrMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6N2NiZDk4NmQtM2ZjMC0zODQxLTllMzctNDQ0Mjg2ZTYyY2NjIiBzdEV2dDp3aGVuPSIyMDIyLTAzLTIyVDE1OjI1OjE5KzAzOjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+2MIhNgAAAGJJREFUSIntlzEOwCAIRfHz6GG9VBfjoIMDwVR/QhdfoiTwQAR1GiNbJJl5AQYF9o0s8QFMQAO+xTfRpZmZ9Q+ccbSVD8BEZ4uLyLaSOxOy2i13ZhQx7K7svFl2V3ZWf1zOBSMUa2P65yoEAAAAAElFTkSuQmCC');
            pointer-events: none;
        }
        .chat-container {
            flex: none;
            height: 90px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 11px;
            display: flex;
            flex-direction: column;
            background-color: #ffffff; /* ÁôΩËâ≤ËÉåÊôØ */
            border: 1px solid;
            border-color: #808080 #ffffff #ffffff #808080; /* ÂÜÖÂµåÊïàÊûú */
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            margin-top: 20px; /* ‰∏∫Ê†áÈ¢òÊ†èÁïôÂá∫Á©∫Èó¥ */
        }
        .message-input {
            display: flex;
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            background-color: #ffffff;
            padding: 10px 15px;
            box-shadow: none;
            margin-top: auto;
            position: absolute;
            bottom: 22px;
            left: 22px;
            right: 22px;
            width: calc(100% - 44px);
            box-sizing: border-box;
            border: 1px solid;
            border-color: #808080 #ffffff #ffffff #808080; /* ÂÜÖÂµåÊïàÊûú */
        }
        .message-input textarea {
            flex: 1;
            border: none;
            resize: none;
            padding: 8px;
            border-radius: 0;
            font-size: 16px;
            outline: none;
            font-family: "MS Sans Serif", Arial, sans-serif;
            background: transparent;
        }
        .send-btn {
            background-color: #c0c0c0;
            color: #000000;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* ÁªèÂÖ∏Windows 3DÊåâÈíÆËæπÊ°Ü */
            width: 60px;
            height: 40px;
            border-radius: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            font-weight: bold;
            font-size: 12px;
        }
        .send-btn:active {
            border-color: #808080 #ffffff #ffffff #808080; /* Êåâ‰∏ãÊó∂ÂèçËΩ¨ËæπÊ°Ü */
            background-color: #b0b0b0; /* Êåâ‰∏ãÊó∂ËÉåÊôØËâ≤ÂèòÊ∑± */
        }
        .user-message {
            background-color: #e6e6e6;
            color: black;
            padding: 10px 16px;
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            margin: 6px auto;
            align-self: center;
            max-width: 60%;
            word-wrap: break-word;
            box-shadow: none;
            position: relative;
            font-size: 16px;
            text-align: center;
            border: 1px solid #808080;
        }
        .bot-message {
            background-color: #f0f0f0;
            color: black;
            padding: 12px 16px;
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            margin: 8px auto;
            align-self: center;
            max-width: 90%;
            word-wrap: break-word;
            box-shadow: none;
            position: relative;
            width: auto;
            text-align: left;
            font-size: 15px;
            border: 1px solid #808080;
        }
        .emoji-display {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 10px;
            padding: 5px 0;
        }
        .emoji-display span {
            font-size: 32px;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .emoji-display span:hover {
            transform: scale(1.2);
        }
        .emoji-canvas-container {
            width: 90%;
            align-self: center;
            max-width: 800px;
            margin: 8px auto;
            background-color: #c0c0c0;
            border-radius: 0; /* ÁßªÈô§ÂúÜËßí */
            padding: 10px;
            box-shadow: none;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* 3DËæπÊ°Ü */
        }
        .emoji-canvas {
            background-color: #ffffff; /* Á∫ØÁôΩËâ≤ËÉåÊôØ */
            background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 5v1H0V0h5z'/%3E%3Cpath d='M0 0h1v1H0V0zm6 6H5v-1h1v1z'/%3E%3C/g%3E%3C/svg%3E");
            border-radius: 0;
            min-height: 200px;
            height: 280px;
            margin: 0;
            padding: 15px;
            cursor: default;
            overflow: hidden;
            position: relative;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid;
            border-color: #808080 #ffffff #ffffff #808080; /* ÂÜÖÂµåÊïàÊûú */
        }
        .emoji {
            font-size: 36px;
            cursor: move;
            position: absolute;
            user-select: none;
            z-index: 1;
            transition: transform 0.1s;
        }
        .emoji:hover {
            transform: scale(1.1);
        }
        .emoji:active {
            transform: scale(1.2);
        }
        .emoji-controls {
            position: absolute;
            display: none;
            top: -15px;
            right: -15px;
            background-color: white;
            border-radius: 15px;
            padding: 3px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 5;
        }
        .emoji:hover .emoji-controls {
            display: flex;
        }
        .emoji-control-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* 3DËæπÊ°Ü */
            cursor: pointer;
            font-size: 14px;
            border-radius: 0;
            margin: 0 2px;
        }
        .emoji-control-btn:hover {
            background-color: #d0d0d0;
        }
        .emoji-control-btn:active {
            border-color: #808080 #ffffff #ffffff #808080; /* Êåâ‰∏ãÊó∂ÂèçËΩ¨ËæπÊ°Ü */
        }
        .tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tool-btn {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff; /* 3DËæπÊ°Ü */
            border-radius: 0;
            padding: 10px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: none;
            font-size: 16px;
            font-weight: normal;
            box-shadow: none;
        }
        .tool-btn:hover {
            background-color: #d0d0d0;
            transform: none;
            box-shadow: none;
        }
        .tool-btn:active {
            border-color: #808080 #ffffff #ffffff #808080; /* Êåâ‰∏ãÊó∂ÂèçËΩ¨ËæπÊ°Ü */
            transform: none;
            box-shadow: none;
        }
        .color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .color-picker input {
            border: 1px solid #808080;
            outline: none;
            height: 20px;
            width: 20px;
            padding: 0;
            background: none;
            cursor: pointer;
        }
        .gradient-options {
            position: absolute;
            display: none;
            background-color: #c0c0c0;
            border-radius: 0;
            padding: 10px;
            box-shadow: 1px 1px 0 #000000;
            z-index: 100;
            flex-direction: column;
            gap: 6px;
            width: 220px;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
        }
        .gradient-options.show {
            display: flex;
        }
        .gradient-option {
            height: 24px;
            border-radius: 0;
            cursor: pointer;
            transition: none;
            border: 1px solid #808080;
        }
        .gradient-option:hover {
            transform: none;
            border: 1px solid #ffffff;
        }
        .gradient-btn {
            margin-left: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            cursor: pointer;
            border: 1px solid #808080;
        }
        .diary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            margin-bottom: 15px;
        }
        .diary-date, .diary-weather {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .diary-date {
            font-weight: 500;
        }
        .diary-date .calendar-icon {
            margin-right: 6px;
            font-size: 18px;
        }
        .current-weather {
            font-size: 26px;
            margin-left: 10px;
            cursor: pointer;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
        }
        .weather-selector {
            position: absolute;
            display: none;
            background: rgba(255,255,255,0.95);
            border-radius: 10px;
            padding: 8px;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 100;
        }
        .weather-selector.show {
            display: flex;
        }
        .weather-option {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.2s;
        }
        .weather-option:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        /* Ë∞ÉÊï¥emojiÂú®Êó•ËÆ∞‰∏≠ÁöÑÊ†∑Âºè */
        .emoji-canvas .emoji {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        @media (max-width: 600px) {
            .tools {
                flex-direction: row;
                justify-content: space-around;
                flex-wrap: wrap;
            }
            .tool-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
        
        /* Ë∞ÉÊï¥‰æßÈù¢Â∑•ÂÖ∑Ê†èÊ†∑Âºè */
        .side-tools {
            position: absolute;
            right: 22px;
            top: 60px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
            width: 180px;
        }
        
        .side-tools .tool-btn {
            box-shadow: 1px 1px 0 #000000;
            background-color: #c0c0c0;
            border-radius: 0;
            padding: 8px 10px;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            font-size: 14px;
            text-align: left;
            display: flex;
            align-items: center;
        }
        
        .side-tools .tool-btn:active {
            border-color: #808080 #ffffff #ffffff #808080;
            background-color: #b0b0b0;
        }
        
        /* Ë∞ÉÊï¥È¢úËâ≤ÈÄâÊã©Âô® */
        .color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .color-picker input {
            border: 1px solid #808080;
            outline: none;
            height: 20px;
            width: 20px;
            padding: 0;
            background: none;
            cursor: pointer;
        }
        
        .gradient-btn {
            margin-left: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            cursor: pointer;
            border: 1px solid #808080;
        }
        
        /* Ëá™ÂÆö‰πâÊ∏êÂèòÈÉ®ÂàÜ */
        .custom-gradient {
            border-top: 1px solid #808080;
            padding-top: 8px;
            margin-top: 8px;
        }
        
        .custom-gradient-inputs {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .custom-gradient-inputs input {
            border: 1px solid #808080;
            outline: none;
            width: 20px;
            height: 20px;
            padding: 0;
            background: none;
            cursor: pointer;
        }
        
        .custom-gradient-inputs select {
            font-family: "MS Sans Serif", Arial, sans-serif;
            font-size: 12px;
            border: 2px solid;
            border-color: #808080 #ffffff #ffffff #808080;
            background-color: #c0c0c0;
        }
        
        .custom-gradient-preview {
            height: 24px;
            border-radius: 0;
            margin-bottom: 8px;
            border: 1px solid #808080;
        }
        
        .custom-gradient-btn {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            border-radius: 0;
            padding: 4px 8px;
            cursor: pointer;
            width: 100%;
            font-size: 12px;
            font-family: "MS Sans Serif", Arial, sans-serif;
        }
        
        .custom-gradient-btn:active {
            border-color: #808080 #ffffff #ffffff #808080;
            background-color: #b0b0b0;
        }
        
        /* Ê∑ªÂä†Ë≠¶ÂëäÈ£éÊ†ºÂÖÉÁ¥† */
        .warning-text {
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            color: #000000;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
        }
        
        /* ÁºñÁ†ÅÂô®Áä∂ÊÄÅÊ†è */
        .encoder-status {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background-color: #c0c0c0;
            border-top: 1px solid #808080;
            font-family: "MS Sans Serif", Arial, sans-serif;
            font-size: 12px;
            display: flex;
            align-items: center;
            padding: 0 5px;
            color: #000;
        }
        
        .encoder-progress {
            display: inline-block;
            width: 100px;
            height: 10px;
            background-color: #fff;
            border: 1px solid #808080;
            margin-left: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .encoder-progress-bar {
            position: absolute;
            height: 100%;
            width: 70%;
            background-color: #000080;
            animation: progress 3s infinite linear;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        /* ÁºñÁ†ÅÂô®ÊåâÈíÆÂíåÊéßÂà∂ÂÖÉÁ¥† */
        .encoder-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
        }
        
        .encoder-button {
            background-color: #c0c0c0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            padding: 2px 5px;
            font-family: "MS Sans Serif", Arial, sans-serif;
            font-size: 12px;
            cursor: pointer;
        }
        
        .encoder-button:active {
            border-color: #808080 #ffffff #ffffff #808080;
        }
        
        /* ÁºñÁ†ÅÁªüËÆ°Âå∫ */
        .encoder-stats {
            position: absolute;
            top: 15px;
            left: 15px;
            font-family: "MS Sans Serif", "Courier New", monospace;
            font-size: 12px;
            color: #000;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 3px;
            border: 1px solid #808080;
        }
        /* Â∫ïÈÉ®Â∑•ÂÖ∑Ê†èÊ®™ÂêëÊéíÂàóÔºåË∑üÈöècontainer‰∏ãÊñπ */
        .bottom-tools {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: stretch;
            width: 880px;
            max-width: 82.5vh;
            min-width: 320px;
            margin: 0 auto;
            gap: 0;
            z-index: 200;
            background: #c0c0c0;
            border: 2px solid #808080;
            box-shadow: 0 -2px 0 #fff;
        }
        .bottom-tools .tool-btn {
            flex: 1 1 0;
            margin: 0;
            border-radius: 0;
            border: 2px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            background-color: #c0c0c0;
            font-family: "MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif;
            font-size: 14px;
            text-align: center;
            box-shadow: 1px 1px 0 #000000;
            padding: 8px 0;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            white-space: nowrap;
        }
        .bottom-tools .tool-btn:active {
            border-color: #808080 #ffffff #ffffff #808080;
            background-color: #b0b0b0;
        }
        .bottom-tools .color-picker {
            justify-content: center;
            gap: 8px;
            display: flex;
            align-items: center;
        }
        .bottom-tools .color-picker span {
            display: inline-block;
            margin-right: 4px;
            color: #222;
        }
        .bottom-tools .color-picker input {
            border: 1px solid #808080;
            outline: none;
            height: 20px;
            width: 20px;
            padding: 0;
            background: none;
            cursor: pointer;
        }
        .bottom-tools .gradient-btn {
            margin-left: 5px;
            width: 20px;
            height: 20px;
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            border: 1px solid #808080;
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="container">
            <!-- Â∫ïÈÉ®Ê®™ÂêëÂ∑•ÂÖ∑Ê†è -->
            <div style="height: 0;"></div>
            
            <div id="gradientOptions" class="gradient-options">
                <div class="gradient-option" style="background: linear-gradient(to right, #4facfe, #00f2fe);"></div>
                <div class="gradient-option" style="background: linear-gradient(to right, #ff7e5f, #feb47b);"></div>
                <div class="gradient-option" style="background: linear-gradient(to right, #a8ff78, #78ffd6);"></div>
                <div class="gradient-option" style="background: linear-gradient(to right, #f093fb, #f5576c);"></div>
                <div class="gradient-option" style="background: linear-gradient(to right, #4568dc, #b06ab3);"></div>
                <div class="gradient-option" style="background: linear-gradient(to right, #0ba360, #3cba92);"></div>
                <div class="gradient-option" style="background: linear-gradient(to top, #4481eb, #04befe);"></div>
                <div class="gradient-option" style="background: linear-gradient(to bottom, #48c6ef, #6f86d6);"></div>
                <div class="gradient-option" style="background: linear-gradient(to bottom, #56ccf2, #2f80ed);"></div>
                <div class="gradient-option" style="background: linear-gradient(to top, #6a85b6, #bac8e0);"></div>
                <div class="gradient-option" style="background: linear-gradient(to bottom, #5ee7df, #b490ca);"></div>
                
                <!-- Ëá™ÂÆö‰πâÊ∏êÂèòËâ≤ÈÄâÈ°π -->
                <div class="custom-gradient">
                    <div class="custom-gradient-inputs">
                        <input type="color" id="gradientColor1" value="#48c6ef">
                        <input type="color" id="gradientColor2" value="#6f86d6">
                        <select id="gradientDirection">
                            <option value="to right">Horizontal</option>
                            <option value="to bottom">Vertical</option>
                            <option value="to bottom right">Diagonal</option>
                        </select>
                    </div>
                    <div class="custom-gradient-preview" id="gradientPreview"></div>
                    <button class="custom-gradient-btn" id="applyCustomGradient">Apply Custom Gradient</button>
                </div>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Ê∂àÊÅØ‰ºöÂä®ÊÄÅÊ∑ªÂä†Âà∞ËøôÈáå -->
            </div>
            
            <div id="canvasMount"></div>
            
            <div class="message-input">
                <textarea id="storyInput" placeholder="Enter your story..." rows="1"></textarea>
                <button class="send-btn" id="sendBtn">Encode</button>
            </div>
        </div>
        <div class="bottom-tools">
            <div class="tool-btn color-picker">
                <span>Canvas Color:</span>
                <input type="color" id="canvasColorPicker" value="#e8f0fe">
                <div class="gradient-btn" id="gradientBtn"></div>
            </div>
            <div class="tool-btn" id="clearBtn">Clear Canvas</div>
            <div class="tool-btn" id="saveBtn">Save Creation</div>
        </div>
    </div>

    <script>
        // Ëé∑ÂèñDOMÂÖÉÁ¥†
        const chatContainer = document.getElementById('chatContainer');
        const storyInput = document.getElementById('storyInput');
        const sendBtn = document.getElementById('sendBtn');
        const canvasColorPicker = document.getElementById('canvasColorPicker');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');
        const gradientBtn = document.getElementById('gradientBtn');
        const gradientOptions = document.getElementById('gradientOptions');
        
        // Ëá™ÂÆö‰πâÊ∏êÂèòËâ≤ÂÖÉÁ¥†
        const gradientColor1 = document.getElementById('gradientColor1');
        const gradientColor2 = document.getElementById('gradientColor2');
        const gradientDirection = document.getElementById('gradientDirection');
        const gradientPreview = document.getElementById('gradientPreview');
        const applyCustomGradient = document.getElementById('applyCustomGradient');
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ê∑ªÂä†Ê¨¢ËøéÊ∂àÊÅØÔºåÂπ∂ÂàùÂßãÂåñÁîªÂ∏É
        window.addEventListener('DOMContentLoaded', () => {
            // Ê∑ªÂä†Ê†áÈ¢òËÄå‰∏çÊòØÊ¨¢ËøéÊ∂àÊÅØ
            const headerText = document.createElement('div');
            headerText.textContent = 'ENCODER STATUS:';
            headerText.style.textAlign = 'left';
            headerText.style.padding = '10px';
            headerText.style.fontSize = '16px';
            headerText.style.fontWeight = 'bold';
            headerText.style.marginBottom = '5px';
            headerText.style.fontFamily = '"MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif';
            headerText.style.color = '#000000';
            chatContainer.appendChild(headerText);
            
            // Ê∑ªÂä†Ë≠¶Âëä‰ø°ÊÅØ
            const warningText = document.createElement('div');
            warningText.textContent = 'Enter text to encode into emoji language...';
            warningText.className = 'warning-text';
            warningText.style.fontSize = '14px';
            warningText.style.marginBottom = '10px';
            chatContainer.appendChild(warningText);
            
            // È°µÈù¢Âä†ËΩΩÊó∂Â∞±ÂàõÂª∫ÁîªÂ∏É
            if (!window.emojiCanvas) {
                const mount = document.getElementById('canvasMount');
                window.emojiCanvas = addEmojiCanvas('');
                mount.appendChild(window.emojiCanvas);
            }
            
            // ÂàõÂª∫emojiÈ£éÊ†ºÂÆπÂô®ÔºåÊîæÂú®ÁîªÂ∏É‰∏ãÊñπ
            createEmojiStylesContainer();
            
            // Ë∞ÉÊï¥ÂÆπÂô®Â∏ÉÂ±ÄÔºå‰∏∫Âõ∫ÂÆöÂú®Â∫ïÈÉ®ÁöÑËæìÂÖ•Ê°ÜËÖæÂá∫Á©∫Èó¥
            adjustContainerLayout();
            
            // Êõ¥ÊîπÂèëÈÄÅÊåâÈíÆÊñáÂ≠ó‰∏∫Encode
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.innerHTML = 'Encode';
            sendBtn.style.fontSize = '12px';
            sendBtn.style.fontWeight = 'bold';
        });
        
        // Ë∞ÉÊï¥ÂÆπÂô®Â∏ÉÂ±ÄÂáΩÊï∞
        function adjustContainerLayout() {
            const container = document.querySelector('.container');
            const messageInput = document.querySelector('.message-input');
            
            // ‰∏∫ÊâÄÊúâÂÜÖÂÆπÂÖÉÁ¥†ÂÆπÂô®Ê∑ªÂä†Â∫ïÈÉ®ÂÜÖËæπË∑ùÔºå‰∏∫ËæìÂÖ•Ê°ÜËÖæÂá∫Á©∫Èó¥
            // ÂáèÂ∞ë‰∏∫ËæìÂÖ•Ê°ÜÈ¢ÑÁïôÁöÑÁ©∫Èó¥ÔºåÊ∂àÈô§Êó†Áî®Á©∫Èöô
            document.getElementById('canvasMount').style.marginBottom = '50px';
            
            // Ê∑ªÂä†‰∫ã‰ª∂ÔºåÁ°Æ‰øùÂú®Á™óÂè£Ë∞ÉÊï¥Â§ßÂ∞èÊó∂‰πü‰øùÊåÅÂ∏ÉÂ±Ä
            window.addEventListener('resize', function() {
                // ÈáçÊñ∞Ë∞ÉÊï¥ÂÜÖÂÆπÂå∫ÂüüÁöÑÂ∫ïÈÉ®ËæπË∑ù
                document.getElementById('canvasMount').style.marginBottom = '50px';
            });
        }
        
        // ÂàõÂª∫emojiÈ£éÊ†ºÂÆπÂô®
        function createEmojiStylesContainer() {
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÂÆπÂô®
            if (!document.querySelector('.emoji-styles-container')) {
                const emojiStylesContainer = document.createElement('div');
                emojiStylesContainer.className = 'emoji-styles-container';
                emojiStylesContainer.style.width = '90%';
                emojiStylesContainer.style.maxWidth = '800px';
                emojiStylesContainer.style.marginTop = '8px';
                emojiStylesContainer.style.marginBottom = '0px';
                emojiStylesContainer.style.marginLeft = 'auto';
                emojiStylesContainer.style.marginRight = 'auto';
                emojiStylesContainer.style.padding = '8px';
                emojiStylesContainer.style.borderRadius = '0'; // ÁßªÈô§ÂúÜËßí
                emojiStylesContainer.style.backgroundColor = '#c0c0c0';
                emojiStylesContainer.style.boxShadow = 'none';
                emojiStylesContainer.style.border = '2px solid';
                emojiStylesContainer.style.borderColor = '#ffffff #808080 #808080 #ffffff'; // 3DËæπÊ°Ü
                
                // Ê∑ªÂä†ÈªòËÆ§ÊèêÁ§∫ - Êîπ‰∏∫Ë≠¶ÂëäÈ£éÊ†º
                const placeholder = document.createElement('div');
                placeholder.style.textAlign = 'center';
                placeholder.style.padding = '10px';
                placeholder.style.color = '#000000';
                placeholder.style.fontFamily = '"MS Sans Serif", Arial, sans-serif';
                placeholder.style.fontWeight = 'bold';
                placeholder.textContent = 'Send a message to receive emoji options...';
                emojiStylesContainer.appendChild(placeholder);
                
                // Ê∑ªÂä†Âà∞DOM
                const mount = document.getElementById('canvasMount');
                mount.appendChild(emojiStylesContainer);
            }
        }
        
        // ÂΩìÂâçÁîªÂ∏ÉËÉåÊôØ
        let currentCanvasBackground = '#ffffff';
        
        // ÊîπÂèòÁîªÂ∏ÉËÉåÊôØÈ¢úËâ≤
        canvasColorPicker.addEventListener('input', (e) => {
            currentCanvasBackground = e.target.value;
            applyCanvasBackground(currentCanvasBackground);
        });
        
        // ÊòæÁ§∫Ê∏êÂèòËâ≤ÈÄâÈ°π
        gradientBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            gradientOptions.classList.toggle('show');
            
            // ÂÆö‰ΩçÊ∏êÂèòÈÄâÈ°πÈù¢Êùø
            const rect = gradientBtn.getBoundingClientRect();
            gradientOptions.style.top = (rect.bottom + 5) + 'px';
            gradientOptions.style.left = (rect.left - 70) + 'px';
        });
        
        // ÁÇπÂáªÈ°µÈù¢ÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠Ê∏êÂèòÈÄâÈ°π
        document.addEventListener('click', () => {
            gradientOptions.classList.remove('show');
        });
        
        // ËÆæÁΩÆÊ∏êÂèòËâ≤ËÉåÊôØ
        const gradientElements = document.querySelectorAll('.gradient-option');
        gradientElements.forEach(element => {
            element.addEventListener('click', () => {
                currentCanvasBackground = element.style.background;
                applyCanvasBackground(currentCanvasBackground);
                gradientOptions.classList.remove('show');
            });
        });
        
        // Â∫îÁî®ÁîªÂ∏ÉËÉåÊôØ
        function applyCanvasBackground(background) {
            currentCanvasBackground = background;
            const canvases = document.querySelectorAll('.emoji-canvas');
            canvases.forEach(canvas => {
                canvas.style.background = background;
                // Á°Æ‰øù‰øùÁïôÂÉèÁ¥†ÁÇπËÉåÊôØ
                if (!background.includes('gradient')) {
                    canvas.style.backgroundColor = background;
                    canvas.style.backgroundImage = "url(\"data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 5v1H0V0h5z'/%3E%3Cpath d='M0 0h1v1H0V0zm6 6H5v-1h1v1z'/%3E%3C/g%3E%3C/svg%3E\")";
                } else {
                    canvas.style.backgroundImage = background;
                }
            });
        }
        
        // Ê∏ÖÁ©∫ÁîªÂ∏É
        clearBtn.addEventListener('click', () => {
            const canvases = document.querySelectorAll('.emoji-canvas');
            canvases.forEach(canvas => {
                const emojis = canvas.querySelectorAll('.emoji');
                emojis.forEach(emoji => emoji.remove());
            });
        });
        
        // ‰øùÂ≠òÂàõ‰Ωú
        saveBtn.addEventListener('click', () => {
            const canvases = document.querySelectorAll('.emoji-canvas');
            if (canvases.length === 0) {
                alert('No canvas to save. Please create an Emoji canvas first.');
                return;
            }
            
            // ‰ΩøÁî®ÊúÄÂêé‰∏Ä‰∏™ÁîªÂ∏É
            const canvas = canvases[canvases.length - 1];
            
            try {
                // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÁöÑcanvasÂÖÉÁ¥†
                const tempCanvas = document.createElement('canvas');
                const context = tempCanvas.getContext('2d');
                
                // ËÆæÁΩÆcanvasÂ§ßÂ∞è‰∏éemojiÁîªÂ∏ÉÁõ∏Âêå
                tempCanvas.width = canvas.offsetWidth;
                tempCanvas.height = canvas.offsetHeight;
                
                // ËÆ°ÁÆóËÉåÊôØÔºàÁ∫ØËâ≤ÊàñÊ∏êÂèòÔºâ
                const canvasBackground = canvas.style.background || currentCanvasBackground;
                
                // Â°´ÂÖÖËÉåÊôØÈ¢úËâ≤
                if (canvasBackground.includes('gradient')) {
                    // Â§ÑÁêÜÊ∏êÂèòËÉåÊôØ
                    const gradient = context.createLinearGradient(0, 0, 0, tempCanvas.height);
                    // ÁÆÄÂçïËß£ÊûêÊ∏êÂèòÂ≠óÁ¨¶‰∏≤Êù•ÊèêÂèñÈ¢úËâ≤
                    const match = canvasBackground.match(/linear-gradient\(to bottom, (.*?), (.*?)\)/);
                    if (match && match.length >= 3) {
                        gradient.addColorStop(0, match[1]);
                        gradient.addColorStop(1, match[2]);
                        context.fillStyle = gradient;
                    } else {
                        // ÂõûÈÄÄÂà∞ËìùËâ≤Ê∏êÂèò
                        gradient.addColorStop(0, '#7aadff');
                        gradient.addColorStop(1, '#4c8bf5');
                        context.fillStyle = gradient;
                    }
                    context.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                } else {
                    // Á∫ØËâ≤ËÉåÊôØ
                    context.fillStyle = canvasBackground;
                    context.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                }
                // Âπ≥Èì∫ÂÉèÁ¥†ÁÇπSVGËÉåÊôØÔºàÂ¶ÇÊûúÊúâÔºâ
                const bgImg = canvas.style.backgroundImage;
                if (bgImg && bgImg.includes('svg')) {
                    // ÊèêÂèñSVGÊï∞ÊçÆ
                    const svgMatch = bgImg.match(/url\(["']?(data:image\/svg\+xml;[^"')]+)["']?\)/);
                    if (svgMatch && svgMatch[1]) {
                        const img = new window.Image();
                        img.src = svgMatch[1];
                        img.onload = function() {
                            // Âπ≥Èì∫SVG
                            for (let x = 0; x < tempCanvas.width; x += img.width) {
                                for (let y = 0; y < tempCanvas.height; y += img.height) {
                                    context.drawImage(img, x, y);
                                }
                            }
                            // ÁªòÂà∂emoji
                            const emojis = canvas.querySelectorAll('.emoji');
                            emojis.forEach(emoji => {
                                const x = emoji.offsetLeft;
                                const y = emoji.offsetTop;
                                const emojiText = emoji.querySelector('span')?.textContent || '';
                                context.font = '36px Arial';
                                context.fillStyle = 'black';
                                context.fillText(emojiText, x, y + 36);
                            });
                            // ‰∏ãËΩΩÂõæÁâá
                            try {
                                const dataUrl = tempCanvas.toDataURL('image/png');
                                const link = document.createElement('a');
                                link.download = 'emoji-diary.png';
                                link.href = dataUrl;
                                link.click();
                            } catch (e) {
                                alert('Save failed, possibly due to browser security restrictions. Please try taking a screenshot instead.');
                            }
                        };
                        img.onerror = function() {
                            // ÈôçÁ∫ßÂ§ÑÁêÜÔºöÂè™‰øùÂ≠òÁ∫ØËâ≤ËÉåÊôØ+emoji
                            drawEmojisAndSave();
                        };
                        // ÊèêÂâçreturnÔºåÈò≤Ê≠¢ÂêéÁª≠ÈáçÂ§çÁªòÂà∂
                        return;
                    }
                }
                // Â¶ÇÊûúÊ≤°ÊúâSVGËÉåÊôØÔºåÁõ¥Êé•‰øùÂ≠ò
                drawEmojisAndSave();
                // ÁªòÂà∂emojiÂíå‰øùÂ≠òÁöÑÂáΩÊï∞
                function drawEmojisAndSave() {
                    const emojis = canvas.querySelectorAll('.emoji');
                    emojis.forEach(emoji => {
                        const x = emoji.offsetLeft;
                        const y = emoji.offsetTop;
                        const emojiText = emoji.querySelector('span')?.textContent || '';
                        context.font = '36px Arial';
                        context.fillStyle = 'black';
                        context.fillText(emojiText, x, y + 36);
                    });
                    try {
                        const dataUrl = tempCanvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = 'emoji-diary.png';
                        link.href = dataUrl;
                        link.click();
                    } catch (e) {
                        alert('Save failed, possibly due to browser security restrictions. Please try taking a screenshot instead.');
                    }
                }
            } catch (error) {
                console.error('Save failed:', error);
                alert('Save failed: ' + error.message);
            }
        });
        
        // Âä®ÊÄÅË∞ÉÊï¥ÊñáÊú¨Ê°ÜÈ´òÂ∫¶
        storyInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
        
        // ÂèëÈÄÅÊ∂àÊÅØ
        sendBtn.addEventListener('click', () => {
            sendMessage();
        });
        
        // ÊåâEnterÂèëÈÄÅ
        storyInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // ÂèëÈÄÅÊ∂àÊÅØÂáΩÊï∞
        function sendMessage() {
            const story = storyInput.value.trim();
            if (!story) return;
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addMessage(story, 'user');
            storyInput.value = '';
            storyInput.style.height = 'auto';
            
            // ÂèëÈÄÅÂà∞APIÂπ∂Ê∑ªÂä†ÂõûÂ§çÔºå‰ΩÜ‰∏çÊõøÊç¢Â∑≤ÊúâÂÜÖÂÆπ
            translateToEmoji(story);
        }
        
        // Ê∑ªÂä†Ê∂àÊÅØÂà∞ËÅäÂ§©ÁïåÈù¢ÔºåÊ∑ªÂä†ÂèØÈÄâÁöÑID
        function addMessage(text, type, id) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'user' ? 'user-message' : 'bot-message';
            messageDiv.textContent = text;
            if (id) {
                messageDiv.id = id;
            }
            chatContainer.appendChild(messageDiv);
            // Ê∑ªÂä†ÂêéËá™Âä®ÊªöÂä®Âà∞Â∫ïÈÉ®
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return messageDiv;
        }
        
        // Ê∑ªÂä†EmojiÁîªÂ∏É
        function addEmojiCanvas(emojis) {
            const canvasContainer = document.createElement('div');
            canvasContainer.className = 'emoji-canvas-container';
            canvasContainer.style.width = '90%';
            canvasContainer.style.maxWidth = '800px';
            
            const emojiCanvas = document.createElement('div');
            emojiCanvas.className = 'emoji-canvas';
            // ËÆæÁΩÆÁôΩËâ≤ËÉåÊôØÂíåÂÉèÁ¥†ÁÇπÂõæÊ°à
            emojiCanvas.style.backgroundColor = '#ffffff';
            emojiCanvas.style.backgroundImage = "url(\"data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 5v1H0V0h5z'/%3E%3Cpath d='M0 0h1v1H0V0zm6 6H5v-1h1v1z'/%3E%3C/g%3E%3C/svg%3E\")";
            
            // Ê∑ªÂä†ÁºñÁ†ÅÂô®ÊéßÂà∂ÊåâÈíÆ
            const controls = document.createElement('div');
            controls.className = 'encoder-controls';
            
            const refreshBtn = document.createElement('button');
            refreshBtn.className = 'encoder-button';
            refreshBtn.textContent = 'Refresh';
            refreshBtn.addEventListener('click', function() {
                // Ê∏ÖÁ©∫ËÅäÂ§©ÂÆπÂô®
                chatContainer.innerHTML = '';
                
                // ÈáçÊñ∞Ê∑ªÂä†Ê†áÈ¢òÂíåÊèêÁ§∫ÊñáÊú¨
                const headerText = document.createElement('div');
                headerText.textContent = 'ENCODER STATUS:';
                headerText.style.textAlign = 'left';
                headerText.style.padding = '10px';
                headerText.style.fontSize = '16px';
                headerText.style.fontWeight = 'bold';
                headerText.style.marginBottom = '5px';
                headerText.style.fontFamily = '"MS Sans Serif", "Microsoft Sans Serif", Arial, sans-serif';
                headerText.style.color = '#000000';
                chatContainer.appendChild(headerText);
                
                const warningText = document.createElement('div');
                warningText.textContent = 'Enter text to encode into emoji language...';
                warningText.className = 'warning-text';
                warningText.style.fontSize = '14px';
                warningText.style.marginBottom = '10px';
                chatContainer.appendChild(warningText);
                
                // Ê∏ÖÁ©∫emojiÈ£éÊ†ºÂÆπÂô®
                const emojiStylesContainer = document.querySelector('.emoji-styles-container');
                if (emojiStylesContainer) {
                    emojiStylesContainer.innerHTML = '';
                    
                    const placeholder = document.createElement('div');
                    placeholder.style.textAlign = 'center';
                    placeholder.style.padding = '10px';
                    placeholder.style.color = '#000000';
                    placeholder.style.fontFamily = '"MS Sans Serif", Arial, sans-serif';
                    placeholder.style.fontWeight = 'bold';
                    placeholder.textContent = 'Send a message to receive emoji options...';
                    emojiStylesContainer.appendChild(placeholder);
                }
                
                // Ê∏ÖÁ©∫ÁîªÂ∏É‰∏äÁöÑemoji
                const canvas = window.emojiCanvas;
                if (canvas) {
                    const emojis = canvas.querySelectorAll('.emoji');
                    emojis.forEach(emoji => emoji.remove());
                    
                    // Êõ¥Êñ∞emojiËÆ°Êï∞
                    updateEmojiCount(canvas);
                }
                
                // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
                const statusBar = canvas.querySelector('.encoder-status');
                if (statusBar) {
                    // Ê∏ÖÈô§Áä∂ÊÄÅÊ†èÊâÄÊúâÂÜÖÂÆπ
                    statusBar.innerHTML = '';
                    
                    // ÈáçÊñ∞Ê∑ªÂä†ÊñáÊú¨ÂíåËøõÂ∫¶Êù°
                    statusBar.textContent = 'Ready for encoding...';
                    
                    const progress = document.createElement('div');
                    progress.className = 'encoder-progress';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'encoder-progress-bar';
                    
                    progress.appendChild(progressBar);
                    statusBar.appendChild(progress);
                }
            });
            
            controls.appendChild(refreshBtn);
            emojiCanvas.appendChild(controls);
            
            // Ê∑ªÂä†ÁºñÁ†ÅÁªüËÆ°Âå∫
            const stats = document.createElement('div');
            stats.className = 'encoder-stats';
            stats.innerHTML = 'Status: Ready<br>Emoji Count: 0<br>Version: 1.0';
            emojiCanvas.appendChild(stats);
            
            // Ê∑ªÂä†Áä∂ÊÄÅÊ†è
            const statusBar = document.createElement('div');
            statusBar.className = 'encoder-status';
            statusBar.textContent = 'Ready for encoding...';
            
            const progress = document.createElement('div');
            progress.className = 'encoder-progress';
            
            const progressBar = document.createElement('div');
            progressBar.className = 'encoder-progress-bar';
            
            progress.appendChild(progressBar);
            statusBar.appendChild(progress);
            emojiCanvas.appendChild(statusBar);
            
            canvasContainer.appendChild(emojiCanvas);
            
            return emojiCanvas;
        }
        
        // Ê∑ªÂä†Âçï‰∏™emojiÂà∞ÁîªÂ∏É
        function addSingleEmoji(emoji, canvas) {
            if (emoji.trim()) {
                const emojiContainer = document.createElement('div');
                emojiContainer.className = 'emoji';
                
                // Ê∑ªÂä†emojiÊñáÊú¨
                const emojiText = document.createElement('span');
                emojiText.textContent = emoji;
                emojiText.style.textShadow = '1px 1px 0 rgba(0,0,0,0.2)';
                emojiContainer.appendChild(emojiText);
                
                // Ê∑ªÂä†ÊéßÂà∂ÊåâÈíÆ
                const controls = document.createElement('div');
                controls.className = 'emoji-controls';
                
                // ÊîæÂ§ßÊåâÈíÆ
                const zoomInBtn = document.createElement('button');
                zoomInBtn.className = 'emoji-control-btn';
                zoomInBtn.innerHTML = '+';
                zoomInBtn.title = 'Zoom In';
                zoomInBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const currentSize = parseFloat(getComputedStyle(emojiContainer).fontSize);
                    emojiContainer.style.fontSize = (currentSize + 4) + 'px';
                });
                
                // Áº©Â∞èÊåâÈíÆ
                const zoomOutBtn = document.createElement('button');
                zoomOutBtn.className = 'emoji-control-btn';
                zoomOutBtn.innerHTML = '-';
                zoomOutBtn.title = 'Zoom Out';
                zoomOutBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const currentSize = parseFloat(getComputedStyle(emojiContainer).fontSize);
                    if (currentSize > 20) { // ËÆæÁΩÆÊúÄÂ∞èÂ∞∫ÂØ∏
                        emojiContainer.style.fontSize = (currentSize - 4) + 'px';
                    }
                });
                
                // Âà†Èô§ÊåâÈíÆ
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'emoji-control-btn';
                deleteBtn.innerHTML = '√ó';
                deleteBtn.title = 'Delete';
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    emojiContainer.remove();
                    
                    // Êõ¥Êñ∞emojiËÆ°Êï∞
                    updateEmojiCount(canvas);
                });
                
                controls.appendChild(zoomInBtn);
                controls.appendChild(zoomOutBtn);
                controls.appendChild(deleteBtn);
                emojiContainer.appendChild(controls);
                
                // ÈöèÊú∫‰ΩçÁΩÆ‰ΩÜÈÅøÂºÄËæπÁºòÂíåÊéßÂà∂Âå∫Âüü
                const canvasWidth = canvas.offsetWidth;
                const canvasHeight = canvas.offsetHeight;
                
                const x = 20 + Math.random() * (canvasWidth - 80);
                const y = 50 + Math.random() * (canvasHeight - 100);
                
                emojiContainer.style.left = `${x}px`;
                emojiContainer.style.top = `${y}px`;
                
                canvas.appendChild(emojiContainer);
                makeEmojiDraggable(emojiContainer);
                
                // Êõ¥Êñ∞emojiËÆ°Êï∞
                updateEmojiCount(canvas);
            }
        }
        
        // Êõ¥Êñ∞emojiËÆ°Êï∞
        function updateEmojiCount(canvas) {
            const emojiCount = canvas.querySelectorAll('.emoji').length;
            const statsElement = canvas.querySelector('.encoder-stats');
            if (statsElement) {
                statsElement.innerHTML = `Status: ${emojiCount > 0 ? 'Encoding' : 'Ready'}<br>Emoji Count: ${emojiCount}<br>Version: 1.0`;
            }
        }
        
        // ‰ΩøEmojiÂèØÊãñÂä®
        function makeEmojiDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            element.onmousedown = dragMouseDown;
            element.ontouchstart = dragTouchStart;
            
            function dragMouseDown(e) {
                e.preventDefault();
                // Ëé∑ÂèñÈº†Ê†á‰ΩçÁΩÆ
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function dragTouchStart(e) {
                const touch = e.touches[0];
                pos3 = touch.clientX;
                pos4 = touch.clientY;
                document.ontouchend = closeTouchDragElement;
                document.ontouchmove = elementTouchDrag;
            }
            
            function elementDrag(e) {
                e.preventDefault();
                // ËÆ°ÁÆóÊñ∞‰ΩçÁΩÆ
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // ËÆæÁΩÆÂÖÉÁ¥†Êñ∞‰ΩçÁΩÆ
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }
            
            function elementTouchDrag(e) {
                const touch = e.touches[0];
                pos1 = pos3 - touch.clientX;
                pos2 = pos4 - touch.clientY;
                pos3 = touch.clientX;
                pos4 = touch.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
            
            function closeTouchDragElement() {
                document.ontouchend = null;
                document.ontouchmove = null;
            }
        }
        
        // APIË∞ÉÁî®ÂáΩÊï∞
        async function translateToEmoji(story) {
            try {
                // Ê∑ªÂä†Âä†ËΩΩÊ∂àÊÅØ - ‰ΩøÁî®‰∏Ä‰∏™Âõ∫ÂÆöID‰ª•‰æøÁ®çÂêéÁßªÈô§
                const loadingId = 'loading-message-' + Date.now();
                const loadingMessage = addMessage('Converting your story to Emoji...', 'bot', loadingId);
                
                // APIË∞ÉÁî®
                // const token = 'pat_JHnX7kcTdVe5UjRzLY76zmIhTjTC5pDE7hnUyV6HUGf4Tl4KYcTOS4ZIMsS2uOvu';
                const token = 'pat_6sKpBjBOy38N3gaVDkV6pV1czC4x1Iz2daYHz2YTi20w32c1btTVusQYMeMDk1uU';
                const response = await fetch('https://api.coze.cn/v1/workflow/run', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "workflow_id": "7490112512685129754",
                        "parameters": {
                            "user_id": "12345",
                            "user_name": "George",
                            "input": story
                        }
                    })
                });

                const responseText = await response.text();
                console.log('API raw response:', responseText);
                
                if (!response.ok) {
                    throw new Error(`API error (${response.status}): ${responseText}`);
                }

                try {
                    const data = JSON.parse(responseText);
                    console.log('Parsed API data:', data);
                    
                    if (data.code === 0) {
                        const result = JSON.parse(data.data);
                        console.log('Parsed result data:', result);
                        
                        let emojis = '';
                        if (result.output) {
                            emojis = result.output;
                            console.log('Extracted Emoji string:', emojis);
                        } else {
                            throw new Error('No emoji results in API response data');
                        }
                        
                        // ÁßªÈô§Âä†ËΩΩÊ∂àÊÅØ
                        removeMessageById(loadingId);
                        
                        // Âè™Êõ¥Êñ∞emojiÈ£éÊ†ºÈÄâÊã©Âå∫ÂüüÔºå‰∏çÂΩ±ÂìçÂÖ∂‰ªñÂÜÖÂÆπ
                        updateEmojiStyles(emojis);
                        
                        // Ê∑ªÂä†ÁÆÄÁü≠ÊèêÁ§∫Ê∂àÊÅØ
                        addMessage('Emoji styles updated! Select one to add emojis to your canvas.', 'bot');
                        
                    } else {
                        throw new Error(`API returned error: ${data.msg || 'Unknown error'}`);
                    }
                } catch (jsonError) {
                    console.error('Error processing API response:', jsonError);
                    throw new Error('Error processing API response: ' + jsonError.message);
                }
            } catch (error) {
                console.error('Request error:', error);
                
                // ÁßªÈô§Âä†ËΩΩÊ∂àÊÅØ
                const loadingMessages = document.querySelectorAll('.bot-message');
                loadingMessages.forEach(msg => {
                    if (msg.textContent.includes('Converting your story')) {
                        msg.remove();
                    }
                });
                
                addMessage('Conversion failed: ' + error.message, 'bot');
            }
        }
        
        // Ê†πÊçÆIDÁßªÈô§Ê∂àÊÅØ
        function removeMessageById(id) {
            const message = document.getElementById(id);
            if (message) {
                message.remove();
            }
        }
        
        // Êõ¥Êñ∞emojiÈ£éÊ†ºÈÄâÊã©Âå∫Âüü
        function updateEmojiStyles(emojis) {
            // Ê∏ÖÁ©∫Áé∞ÊúâÁöÑemojiÈ£éÊ†ºÂÆπÂô®ÂÜÖÂÆπ
            const existingContainer = document.querySelector('.emoji-styles-container');
            if (existingContainer) {
                // ‰øùÁïôÂÆπÂô®ÔºåÂè™Ê∏ÖÁ©∫ÂÜÖÂÆπ
                existingContainer.innerHTML = '';
                
                // Ê∑ªÂä†emojiÊòæÁ§∫Âå∫Âüü
                const emojiDisplay = document.createElement('div');
                emojiDisplay.className = 'emoji-display';
                emojiDisplay.style.display = 'flex';
                emojiDisplay.style.flexDirection = 'row';
                emojiDisplay.style.justifyContent = 'space-between';
                emojiDisplay.style.gap = '8px';
                emojiDisplay.style.width = '100%';
                emojiDisplay.style.marginBottom = '0';
                
                // ÈáçÁΩÆÂΩìÂâçÈÄâ‰∏≠ÁöÑÈ£éÊ†ºÁä∂ÊÄÅ
                window.selectedStyle = null;
                window.hasSelectedStyle = false;
                
                // Â∞ÜÊñáÊú¨ÊåâË°åÂàÜÂâ≤
                const lines = emojis.split('\n');
                lines.forEach((line, index) => {
                    if (line.trim()) {
                        const lineDiv = document.createElement('div');
                        lineDiv.style.padding = '10px';
                        lineDiv.style.backgroundColor = '#ffffff';
                        lineDiv.style.borderRadius = '0'; // ÁßªÈô§ÂúÜËßí
                        lineDiv.style.boxShadow = 'none';
                        lineDiv.style.border = '1px solid';
                        lineDiv.style.borderColor = '#808080 #ffffff #ffffff #808080'; // ÂÜÖÂµåÊïàÊûú
                        lineDiv.style.cursor = 'pointer';
                        lineDiv.style.transition = 'all 0.3s ease';
                        lineDiv.dataset.styleIndex = index;
                        lineDiv.style.flex = '1';
                        lineDiv.style.minWidth = '0';
                        lineDiv.style.maxWidth = '32%';
                        lineDiv.style.marginBottom = '0';
                        lineDiv.style.maxHeight = '120px';
                        lineDiv.style.overflow = 'hidden';
                        
                        // Ê∑ªÂä†ÈÄâ‰∏≠ÊïàÊûú
                        lineDiv.addEventListener('click', () => {
                            if (!window.hasSelectedStyle) {
                                window.selectedStyle = index;
                                window.hasSelectedStyle = true;
                                
                                document.querySelectorAll('.emoji-display > div').forEach(div => {
                                    const styleIndex = parseInt(div.dataset.styleIndex);
                                    if (styleIndex === index) {
                                        div.style.backgroundColor = '#c0c0c0'; // ÈÄâ‰∏≠ËÉåÊôØËâ≤Êîπ‰∏∫ÁÅ∞Ëâ≤
                                        div.style.transform = 'scale(1)'; // ÁßªÈô§Áº©ÊîæÊïàÊûú
                                        div.style.cursor = 'default';
                                        div.style.borderColor = '#808080 #ffffff #ffffff #808080'; // Êõ¥ÊîπËæπÊ°Ü‰∏∫ÂÜÖÂµåÊïàÊûú
                                        
                                        // ÊøÄÊ¥ªÈÄâ‰∏≠È£éÊ†ºÁöÑemoji
                                        const emojiSpans = div.querySelectorAll('span');
                                        emojiSpans.forEach(span => {
                                            span.style.cursor = 'pointer';
                                            span.style.opacity = '1';
                                            span.style.pointerEvents = 'auto';
                                        });
                                    } else {
                                        div.style.backgroundColor = '#e0e0e0';
                                        div.style.opacity = '0.5';
                                        div.style.cursor = 'not-allowed';
                                        
                                        // Á¶ÅÁî®Êú™ÈÄâ‰∏≠È£éÊ†ºÁöÑemoji
                                        const emojiSpans = div.querySelectorAll('span');
                                        emojiSpans.forEach(span => {
                                            span.style.cursor = 'default';
                                            span.style.opacity = '0.5';
                                            span.style.transform = 'scale(1)';
                                            span.style.pointerEvents = 'none';
                                        });
                                    }
                                });
                            }
                        });
                        
                        const parts = line.split(':');
                        if (parts.length === 2) {
                            // Ê∑ªÂä†emojiÂÆπÂô®
                            const emojiContainer = document.createElement('div');
                            emojiContainer.style.display = 'flex';
                            emojiContainer.style.flexWrap = 'wrap';
                            emojiContainer.style.gap = '6px';
                            emojiContainer.style.alignItems = 'center';
                            emojiContainer.style.justifyContent = 'center';
                            
                            // ÊèêÂèñÊâÄÊúâemoji
                            const emojisArray = [];
                            [...parts[1]].forEach(char => {
                                const isEmoji = /\p{Emoji}|\p{Emoji_Presentation}|\p{Extended_Pictographic}/u.test(char);
                                const specialCharMap = {
                                    '‚ôÇ': 'üë®',
                                    '‚ôÄ': 'üë©',
                                    '‚ùÑ': '‚ùÑÔ∏è',
                                    '‚≠ê': '‚≠êÔ∏è',
                                    '‚òÄ': '‚òÄÔ∏è',
                                };
                                
                                const displayChar = specialCharMap[char] || char;
                                
                                if (isEmoji || specialCharMap[char]) {
                                    emojisArray.push(displayChar);
                                }
                            });
                            
                            // ËÆ°ÁÆóÈÄÇÂΩìÁöÑÂ≠ó‰ΩìÂ§ßÂ∞èÂíåÊØèË°åÊòæÁ§∫ÁöÑemojiÊï∞Èáè
                            const totalEmojis = emojisArray.length;
                            let fontSize = 24; // ÈªòËÆ§Â≠ó‰ΩìÂ§ßÂ∞è
                            let emojisPerRow = Math.ceil(Math.sqrt(totalEmojis)); // ÈªòËÆ§Âü∫‰∫éÊÄªÊï∞ÁöÑÂπ≥ÊñπÊ†π
                            
                            // Ê†πÊçÆemojiÊï∞ÈáèÂä®ÊÄÅË∞ÉÊï¥Â§ßÂ∞è
                            if (totalEmojis > 10) {
                                fontSize = 18; // Ë∞ÉÊï¥‰∏∫18px
                                emojisPerRow = Math.ceil(totalEmojis / 2); // ÊúÄÂ§öÊòæÁ§∫2Ë°å
                            }
                            if (totalEmojis > 15) {
                                fontSize = 16; // Ë∞ÉÊï¥‰∏∫16px
                                emojisPerRow = Math.ceil(totalEmojis / 2);
                            }
                            if (totalEmojis > 20) {
                                fontSize = 14; // Ë∞ÉÊï¥‰∏∫14px
                                emojisPerRow = Math.ceil(totalEmojis / 2);
                            }
                            
                            // ÂàõÂª∫emojiÂÖÉÁ¥†
                            emojisArray.forEach(displayChar => {
                                const span = document.createElement('span');
                                span.textContent = displayChar;
                                span.style.fontSize = `${fontSize}px`;
                                span.style.cursor = 'default';
                                span.style.transition = 'transform 0.1s, opacity 0.3s';
                                span.style.display = 'inline-block';
                                span.style.opacity = '0.5';
                                span.style.pointerEvents = 'none';
                                span.style.lineHeight = '1.2';
                                // Ê∑ªÂä†ÂÉèÁ¥†È£éÊ†ºÈò¥ÂΩ±ÊïàÊûú
                                span.style.textShadow = '1px 1px 0 #000';
                                
                                span.addEventListener('mouseover', () => {
                                    if (window.selectedStyle === index) {
                                        span.style.transform = 'scale(1.2)';
                                    }
                                });
                                
                                span.addEventListener('mouseout', () => {
                                    if (window.selectedStyle === index) {
                                        span.style.transform = 'scale(1)';
                                    }
                                });
                                
                                span.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    if (window.selectedStyle === index && window.emojiCanvas) {
                                        addSingleEmoji(displayChar, window.emojiCanvas);
                                    }
                                });
                                
                                emojiContainer.appendChild(span);
                            });
                            
                            lineDiv.appendChild(emojiContainer);
                        }
                        
                        emojiDisplay.appendChild(lineDiv);
                    }
                });
                
                existingContainer.appendChild(emojiDisplay);
            }
        }
        
        // ÂàùÂßãÂåñÊó∂ËÆæÁΩÆÈ°µÈù¢ËÉåÊôØÈ¢úËâ≤Ôºà‰øùÊåÅ‰∏çÂèòÔºâ
        document.body.style.backgroundColor = 'white';
        
        // Êõ¥Êñ∞Ëá™ÂÆö‰πâÊ∏êÂèòÈ¢ÑËßà
        function updateGradientPreview() {
            const color1 = gradientColor1.value;
            const color2 = gradientColor2.value;
            const direction = gradientDirection.value;
            const gradient = `linear-gradient(${direction}, ${color1}, ${color2})`;
            gradientPreview.style.background = gradient;
        }
        
        // ÂàùÂßãÂåñÊ∏êÂèòÈ¢ÑËßà
        updateGradientPreview();
        
        // ÁõëÂê¨Ëá™ÂÆö‰πâÊ∏êÂèòËâ≤ËæìÂÖ•ÂèòÂåñ
        gradientColor1.addEventListener('input', updateGradientPreview);
        gradientColor2.addEventListener('input', updateGradientPreview);
        gradientDirection.addEventListener('change', updateGradientPreview);
        
        // Â∫îÁî®Ëá™ÂÆö‰πâÊ∏êÂèò
        applyCustomGradient.addEventListener('click', () => {
            const color1 = gradientColor1.value;
            const color2 = gradientColor2.value;
            const direction = gradientDirection.value;
            const customGradient = `linear-gradient(${direction}, ${color1}, ${color2})`;
            currentCanvasBackground = customGradient;
            applyCanvasBackground(customGradient);
            gradientOptions.classList.remove('show');
        });
        
        // ‰øÆÂ§çÊ∏êÂèòÊñπÂêëÈÄâÊã©Âô®
        document.getElementById('gradientDirection').addEventListener('change', function(e) {
            e.stopPropagation(); // ÈòªÊ≠¢‰∫ã‰ª∂ÂÜíÊ≥°ÔºåÈò≤Ê≠¢ÂÖ≥Èó≠Èù¢Êùø
            updateGradientPreview();
        });
        
        // ÁÇπÂáªÈ°µÈù¢ÂÖ∂‰ªñÂå∫ÂüüÂÖ≥Èó≠Ê∏êÂèòÈÄâÈ°πÔºå‰ΩÜÊéíÈô§ÈÄâÊã©Âô®Êú¨Ë∫´
        document.addEventListener('click', (e) => {
            if (!gradientOptions.contains(e.target) && e.target !== gradientBtn) {
                gradientOptions.classList.remove('show');
            }
        });
        
        // Èò≤Ê≠¢ÁÇπÂáªÊ∏êÂèòÈÄâÈ°πÈù¢ÊùøÊó∂ÂÖ≥Èó≠ÂÆÉ
        gradientOptions.addEventListener('click', (e) => {
            e.stopPropagation();
        });
    </script>
</body>
</html> 
